<!doctype html><html lang=ja><head><meta charset=utf-8><title>Ktorã¨Stripeã§ECã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã¿ãŸ - yyh-gl's Tech Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href="/favicon/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon/favicon-16x16.png?v=1"><link rel=manifest href="/favicon/site.webmanifest?v=1"><link rel=mask-icon href="/favicon/safari-pinned-tab.svg?v=1" color=#ffffff><link rel="shortcut icon" href="/favicon/favicon.ico?v=1"><meta name=msapplication-config content="/favicon/browserconfig.xml?v=1"><meta name=msapplication-TileColor content="#ffffff"><meta name=theme-color content="#ffffff"><meta name=generator content="Hugo 0.118.2"><meta property="og:site_name" content="yyh-gl's Tech Blog"><meta property="og:title" content="Ktorã¨Stripeã§ECã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã¿ãŸ"><meta property="og:description" content="Stripeã™ã”ã„"><meta property="description" content="Stripeã™ã”ã„"><meta property="og:url" content="https://tech.yyh-gl.dev/blog/kotlin-ktor-stripe-tutorial/"><meta property="og:type" content="article"><meta property="og:image" content="https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/featured.webp"><meta property="og:image:alt" content="featured"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css><script src=https://kit.fontawesome.com/04f97481a8.js crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css><link rel=stylesheet href=/css/main.min.5763d9ff7162a5bc3798713616417208d54ab15e10f48652441811c32135c333.css integrity="sha256-V2PZ/3Fipbw3mHE2FkFyCNVKsV4Q9IZSRBgRwyE1wzM="><link rel=stylesheet href=/css/add-on.css><link rel=stylesheet href=/css/prism.css><link rel=alternate type=application/atom+xml title=Atom href=/index.xml><script src=https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js></script>
<script src=/js/vue.min.js></script>
<script src=/js/good-counter.js defer></script></head><body><header id=site-header><nav id=site-nav><h1 class=nav-title><a href=/ class=nav>Blog</a></h1><menu id=site-nav-menu class="flyout-menu menu"><a href=/ class="nav link"><i class='fa fa-home'></i> Home</a>
<a href=/about/ class="nav link"><i class='far fa-id-card'></i> About</a>
<a href=/blog/ class="nav link"><i class='far fa-newspaper'></i> Blog</a>
<a href=/categories/ class="nav link"><i class='fas fa-sitemap'></i> Categories</a></menu>
<a href=#site-nav class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav></header><div id=wrapper><section id=site-intro><a href=/><img src=https://tech.yyh-gl.dev/img/main/logo.webp class=circle width=80 alt="yyh-gl's icon"></a><header><h1>yyh-gl's Tech Blog</h1></header><main><p>æŠ€è¡“ãƒã‚¿ä¸­å¿ƒã®ãƒ–ãƒ­ã‚°ã§ã™ã€‚ä¸»ãªæ‰±ã„ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ€è¡“ã¨è¨­è¨ˆã§ã™ã€‚</p></main><footer><ul class=socnet-icons><li><a href=//github.com/yyh-gl target=_blank rel=noopener title=GitHub class="fa-brands fa-github"></a></li><li><a href=//www.linkedin.com/in/yyh-gl target=_blank rel=noopener title=LinkedIn class="fa-brands fa-linkedin"></a></li><li><a href=//x.com/yyh_gl target=_blank rel=noopener title=Twitter class="fa-brands fa-x-twitter"></a></li><li><a href=//bsky.app/profile/yyh-gl.bsky.social target=_blank title=Bluesky class="fa-solid fa-cloud"></a></li><li><a href=//speakerdeck.com/yyh_gl target=_blank title="Speaker Deck" class="fa-brands fa-speaker-deck"></a></li><li><a href=//crowdin.com/profile/yyh-gl target=_blank title=Crowdin class="fa-solid fa-pen-square"></a></li></ul></footer></section><main id=site-main><article class=post><header><div class=title><h2><a href=/blog/kotlin-ktor-stripe-tutorial/>Ktorã¨Stripeã§ECã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã¿ãŸ</a></h2><p>Stripeã™ã”ã„</p></div><div class=meta><time datetime="2022-12-21 00:00:00 +0900 +0900">2022-12-21</time><p>yyh-gl</p><p>7 åˆ†ã§èª­ã‚ã¾ã™</p></div></header><div id=socnet-share></div><div class=content><a href=/blog/kotlin-ktor-stripe-tutorial/ class=image style="--bg-image:url('https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/featured.webp')"><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/featured.webp alt=featured></a><h1 id=kotlin-advent-calendar-2022>Kotlin Advent Calendar 2022</h1><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/qiita_advent_calendar_2022.webp width=700><p>æœ¬è¨˜äº‹ã¯<a href=https://qiita.com/advent-calendar/2022/kotlin target=_blank rel="noopener noreferrer">Kotlin Advent Calendar 2022</a>
ã®21æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚</p><h1 id=æ¦‚è¦>æ¦‚è¦</h1><p>ã‚¯ãƒªã‚¹ãƒã‚¹ã¨ã„ãˆã°ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã€‚<br>ã¨ã„ã†ã“ã¨ã§ECã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚</p><p>ECã‚µã‚¤ãƒˆã¨è¨€ã„ã¤ã¤ã‚‚ã‚ã¾ã‚Šè¤‡é›‘ãªã“ã¨ã¯ã›ãšã«ã€Stripeã‹ã‚‰å–å¾—ã—ãŸå•†å“æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ç”»é¢ã‚’ä½œã‚‹ã¨ã“ã‚ã¾ã§ã‚„ã‚Šã¾ã™ã€‚<br>æœ¬ç”»é¢ã‚’å®Ÿè£…ã™ã‚‹éç¨‹ã§ã€APIã‚’çµŒç”±ã—ãŸæƒ…å ±ã®ã‚„ã‚Šã¨ã‚Šâ†’å—ã‘å–ã£ãŸæƒ…å ±ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã¨ã“ã‚ã¾ã§è§¦ã‚Œã¾ã™ã€‚<br>ã‚ˆã£ã¦ã€æœ¬è¨˜äº‹ã‚’èª­ã‚ã°Kotlinã§å¤–éƒ¨APIï¼ˆä¸»ã«Stripeï¼‰ã‚’ä½¿ã£ãŸã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã–ã£ãã‚Šæ´ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><br><p>ãŸã ãŸã Kotlinã§ä½œã‚‹ã ã‘ã§ã¯ãªãã¦ã€å€‹äººçš„ã«ã“ã‚Œã¾ã§è§¦ã£ãŸã“ã¨ãªã„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ã¿ãŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p><blockquote><p>å€‹äººçš„ã«ã“ã‚Œã¾ã§è§¦ã£ãŸã“ã¨ãªã„</p></blockquote><p>ã‚ãŸã‹ã‚‚Kotlinã¯è§¦ã£ãŸã“ã¨ã‚ã‚‹ã‚ˆã†ãªè¨€ã„æ–¹ã§ã™ãŒã€ç§ã¯ã“ã‚Œã¾ã§Goä¸­å¿ƒã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢äººç”Ÿã§ã—ãŸã€‚<br>ã—ãŸãŒã£ã¦ã€ãã‚‚ãã‚‚Kotlinè‡ªä½“ã‚ã¾ã‚Šè§¦ã£ãŸã“ã¨ãŒãªã„ã§ã™â†<br>Kotlinã®ãŠä½œæ³•ã‚’å®ˆã‚Œã¦ã„ãªã„ã¨ã“ã‚ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚“ãªæ„Ÿã˜ã§ä½œã‚Œã‚‹ã®ã‹ãã¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨å¹¸ã„ã§ã™ã€‚</p><br><p>ã§ã¯ã€æ¡ç”¨æŠ€è¡“ã‚’ç´¹ä»‹ã—ãŸã‚‰ã€ã•ã£ããECã‚µã‚¤ãƒˆã‚’ä½œã£ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚<br></p><br><p>âš ï¸ æœ¬è¨˜äº‹å†…ã«è¨˜è¼‰ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã¯<code>package</code>ã‚„<code>import</code>å‘¨ã‚Šã®ã‚³ãƒ¼ãƒ‰ã‚’çœç•¥ã—ã¦ã„ã¾ã™ã€‚<br>ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’è¦‹ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒ¼ãƒ‰ã‚’ç½®ã„ã¦ã„ã‚‹ã®ã§ã“ã¡ã‚‰ã‚’å‚ç…§ãã ã•ã„ã€‚<br><a href=https://github.com/yyh-gl/ktor-shop/ target=_blank rel="noopener noreferrer">https://github.com/yyh-gl/ktor-shop/</a></p><h1 id=æ¡ç”¨æŠ€è¡“>æ¡ç”¨æŠ€è¡“</h1><ul><li>Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼š<a href=https://ktor.io/ target=_blank rel="noopener noreferrer">Ktor</a></li><li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ï¼š<a href=https://freemarker.apache.org/ target=_blank rel="noopener noreferrer">FreeMarker</a></li><li>æ±ºæ¸ˆãŠã‚ˆã³å•†å“ç®¡ç†ï¼š<a href=https://stripe.com/jp target=_blank rel="noopener noreferrer">Stripe</a></li><li>DIï¼š<a href=https://insert-koin.io/ target=_blank rel="noopener noreferrer">Koin</a></li></ul><h1 id=hello-world>Hello World</h1><p>ã¾ãšã¯ã€ŒHello Worldã€ã—ã¦ã„ãã¾ã™ã€‚</p><p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¯ä¸‹è¨˜å…¬å¼ã‚µã‚¤ãƒˆã«è¨˜è¼‰ã®æ‰‹é †ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚</p><p><a href=https://ktor.io/docs/intellij-idea.html#create_ktor_project target=_blank rel="noopener noreferrer">https://ktor.io/docs/intellij-idea.html#create_ktor_project</a></p><br><p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/dependency.webp width=700><p><br><br></p><p>ã‚³ãƒ¼ãƒ‰ãŒã²ã¨ã¨ãŠã‚Šã§ãã‚ãŒã£ãŸã‚‰ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚</p><p><code>$ ./gradlew run</code></p><p>ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãŸã‚‰ <code>http://localhost:8080/</code> ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚<br></p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/hello_world.webp width=500><p>ã€ŒHello World!ã€ã‚’è¡¨ç¤ºã§ãã¾ã—ãŸã€‚</p><h2 id=auto-reloadã®æœ‰åŠ¹åŒ–>Auto-reloadã®æœ‰åŠ¹åŒ–</h2><p>é–‹ç™ºã—ã¦ã„ãä¸Šã§ã¯Auto-reloadãŒã‚ã£ãŸæ–¹ãŒä¾¿åˆ©ãªã®ã§Auto-reloadã‚’æœ‰åŠ¹ã«ã—ã¦ã„ãã¾ã™ã€‚</p><p>Auto-reloadã‚’æœ‰åŠ¹åŒ–ã™ã‚‹æ‰‹é †ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p><ol><li>developmentãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–</li><li>ç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ<br><code>$ ./gradlew -t build</code></li><li>ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•<br><code>$ ./gradlew run</code></li></ol><p>ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ‰‹é †ãŒHello Worldã®ã¨ãã‚ˆã‚Šã‚‚2ã¤å¢—ãˆã¦ã„ã¾ã™ã€‚<br>è©³ã—ãè¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/76a363e79e91e8c7f5cb6d924f1aa2b7540d7328 target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><h3 id=1-developmentãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–>1. developmentãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–</h3><p>developmentãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚<br>ä»Šå›ã¯<code>EngineMain</code>ã‚’ä½¿ã£ãŸæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚<br></p><p>ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã¯<code>embeddedServer</code>ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ã§<code>EngineMain</code>ã«å¤‰æ›´ã—ã¾ã™ã€‚<br>ï¼ˆ<code>EngineMain</code>ãŠã‚ˆã³<code>embeddedServer</code>ã®é•ã„ã¯<a href=https://ktor.io/docs/create-server.html#embedded target=_blank rel="noopener noreferrer">ã“ã¡ã‚‰</a>
ï¼‰</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/Application.kt

fun main(args: Array&lt;String&gt;): Unit = EngineMain.main(args)

fun Application.module() {
    configureRouting()
}
</code></pre><p>ç¶šã„ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚<br><code>src/main/resources</code>é…ä¸‹ã«<code>application.conf</code>ã‚’è¨­ç½®ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-conf>// ktor-shop/src/main/resources/application.conf

ktor {
    application {
        modules = [ com.example.ApplicationKt.module ]
    }

    development = true
    deployment {
        port = 8080
        watch = [ classes, resources ]
    }
}
</code></pre><p><code>embeddedServer</code>ã«æ¸¡ã—ã¦ã„ãŸè¨­å®šæƒ…å ±ã¨åŒæ§˜ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚„ãƒãƒ¼ãƒˆãªã©ã®è¨­å®šãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚<br>ç‰¹ç­†ã™ã¹ãã¯<code>development = true</code>ãŠã‚ˆã³<code>watch = [ classes, resources ]</code>ã§ã™ã€‚</p><p><code>development = true</code>ã§developmentãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–ã—ã¦ã„ã¾ã™ã€‚<br>developmentãƒ¢ãƒ¼ãƒ‰ãŒç„¡åŠ¹ã ã¨Auto-reloadã¯æœ‰åŠ¹ã«ãªã‚Šã¾ã›ã‚“ã€‚</p><p><code>watch = [ classes, resources ]</code>ã¯Auto-reloadã®ç›£è¦–å¯¾è±¡ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚<br>ï¼ˆ<a href=https://ktor.io/docs/auto-reload.html#watch-paths target=_blank rel="noopener noreferrer">å‚è€ƒ</a>
ï¼‰</p><br><p><code>EngineMain</code>ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§
<code>resources</code>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®<code>application.conf</code>ã¾ãŸã¯<code>application.yaml</code>ã‚’å‚ç…§ã™ã‚‹ã®ã§ã€
ä»¥ä¸Šã®ä½œæ¥­ã§developmentãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚<br>ï¼ˆ<a href=https://ktor.io/docs/create-server.html#engine-main target=_blank rel="noopener noreferrer">å‚è€ƒ</a>
ï¼‰</p><h3 id=2-ç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ--gradlew--t-build>2. ç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ <code>$ ./gradlew -t build</code></h3><p>å¤šãã®Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯è¨­å®šã‚’ã„ã˜ã‚Œã°ç°¡å˜ã«Auto-reloadãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ãŒã€<br>Ktorã§ã¯ã‚‚ã†ã²ã¨ä½œæ¥­å¿…è¦ã«ãªã‚Šã¾ã™ã€‚</p><p>ãã‚ŒãŒç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã§ã™ã€‚</p><p>ä½œæ¥­ã¨ã—ã¦ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§ã™ã€‚</p><p><code>$ ./gradlew -t build</code></p><p><code>-t</code>ãŒç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚</p><p>ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›´ãŒã‚ã‚‹ãŸã³ã«ãƒ“ãƒ«ãƒ‰ã—ç›´ã™ã‹ã‚‰ã€Œç¶™ç¶šçš„ãªãƒ“ãƒ«ãƒ‰ã€ã§ã™ã€‚</p><p><br><br></p><p>ã“ã“ã¾ã§ã§ããŸã‚‰å†åº¦ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><p><code>$ ./gradlew run</code><br>ï¼ˆ<code>./gradlew -t build</code>ã‚‚å®Ÿè¡Œã—ãŸã¾ã¾ï¼‰</p><p>ã€ŒHello World!ã€ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚</p><p>ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {

  routing {
    get(&quot;/&quot;) {
      call.respondText(&quot;Hello World2!&quot;)
    }
  }
}
</code></pre><p>ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹ã¨ä»¥ä¸‹ã®é€šã‚Šè¡¨ç¤ºãŒå¤‰åŒ–ã—ã¾ã—ãŸã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/autoreload.webp width=500><p>ã†ã¾ãAuto-reloadã§ãã¦ã„ã¾ã™ã­ã€‚</p><h1 id=å®Ÿè£…ç‰©ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰>å®Ÿè£…ç‰©ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰</h1><p>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®<a href=https://freemarker.apache.org/ target=_blank rel="noopener noreferrer">FreeMarker</a>
ã‚’ä½¿ã„ãªãŒã‚‰<br>ã“ã‚Œã‹ã‚‰ä½œã‚ã†ã¨ã—ã¦ã„ã‚‹ã‚‚ã®ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰ã—ã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/3003aadda191599ccbed9148ba2f8cbb54b47e7f target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><p>ã¾ãšã¯ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-freemarker>// ktor-shop/src/main/resources/templates/contents.ftl

&lt;html&gt;
  &lt;body&gt;
  &lt;#list contents as content&gt;
    &lt;div&gt;
      ${content.id}
      ${content.name}
      ${content.price}
    &lt;/div&gt;
  &lt;/#list&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><code>&lt;#list contents as content></code>ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ¸¡ã—ãŸ<code>contents</code>ã®ä¸­èº«ã‚’ã²ã¨ã¤ãšã¤å–ã‚Šå‡ºã—ã¾ã™ã€‚<br>ãã—ã¦</p><pre class=line-numbers><code>${content.id}
${content.name}
${content.price}
</code></pre><p>ã«ã¦<code>id</code>, <code>name</code>, <code>price</code>æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p><p>æ¬¡ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«å€¤ã‚’æ¸¡ã—ã¾ã™ã€‚<br><code>Routing.kt</code>ã‚’ä»¥ä¸‹ã®é€šã‚Šå¤‰æ›´ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

data class Content(val id: Int, val name: String, val price: Int)

fun Application.configureRouting() {
  routing {
    get(&quot;/&quot;) {
      val contents: List&lt;Content&gt; = listOf(
        Content(1, &quot;èµ¤ãƒšãƒ³&quot;, 100),
        Content(2, &quot;é’ãƒšãƒ³&quot;, 200),
      )
      call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents)))
    }
  }
}
</code></pre><p>å•†å“æƒ…å ±ï¼ˆ<code>contents</code>ï¼‰ã¯ä¸€æ—¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ãŠãã¾ã™ã€‚<br></p><p><code>call.respond(FreeMarkerContent("contents.ftl", mapOf("contents" to contents)))</code>ã«ã¦<br><code>contents.ftl</code>ã«<code>contents</code>ã‚’æ¸¡ã—ãŸä¸Šã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å‡¦ç†ã—ã¦ã„ã¾ã™ã€‚</p><p>çµæœã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã®ãŒä»¥ä¸‹ã®ç”»é¢ã§ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/contents_by_freemarker.webp width=600><p>å•†å“æƒ…å ±ãŒã²ã¨ã¤ãšã¤è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚</p><p>ä»Šå›ã¯ã“ã‚Œä»¥ä¸ŠUIã«ã“ã ã‚ã‚‹ã“ã¨ã¯ã—ã¾ã›ã‚“â†</p><p><br><br></p><p>ã“ã“ã¾ã§ã§ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ã‚³ãƒ¼ãƒ‰ãŠã‚ˆã³é–‹ç™ºã—ã‚„ã™ã„ç’°å¢ƒãŒæ•´ã„ã€
ã“ã‚Œã‹ã‚‰ä½œã£ã¦ã„ãã‚‚ã®ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰ã—ã¾ã—ãŸã€‚<br>æ¬¡ç« ã‹ã‚‰StripeçµŒç”±ã§å•†å“æƒ…å ±ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ãã¾ã™ã€‚</p><h1 id=å•†å“ç™»éŒ²stripe>å•†å“ç™»éŒ²ï¼ˆStripeï¼‰</h1><p>Stripeã«è²©å£²ã™ã‚‹å•†å“ã®æƒ…å ±ã‚’ç™»éŒ²ã—ã¾ã™ã€‚<br>ï¼ˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã¯çœç•¥ã—ã¾ã™ï¼‰</p><br><p>ã€å•†å“ã€ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€å•†å“ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_content1.webp width=600><p>å•†å“æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã€å•†å“ã‚’ä¿å­˜ã€ã™ã‚‹ã¨</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_content2.webp width=600><p>ç™»éŒ²ã—ãŸå•†å“ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_content3.webp width=600><p>å•†å“ç™»éŒ²ã¯ä»¥ä¸Šã§OKã§ã™ã€‚</p><p>ã§ã¯ã•ã£ããã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p><h1 id=å•†å“æƒ…å ±ã®å–å¾—>å•†å“æƒ…å ±ã®å–å¾—</h1><p>ä»Šå›ã¯ãŸã å®Ÿè£…ã™ã‚‹ã ã‘ã§ãªãã€ã‚ã‚‹ç¨‹åº¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ†ã‘ã¦å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚<br>å„å±¤ã‚’é †ã«ä½œã£ã¦ã„ãã€æœ€çµ‚çš„ã«å•†å“æƒ…å ±ã‚’Stripeã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</p><p>ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚<br>ï¼ˆ<code>src</code>é…ä¸‹ã ã‘è¡¨ç¤ºï¼‰</p><pre class=line-numbers><code>src
â””â”€â”€ main
    â”œâ”€â”€ kotlin
    â”‚Â Â  â””â”€â”€ com
    â”‚Â Â      â””â”€â”€ example
    â”‚Â Â          â”œâ”€â”€ Application.kt
    â”‚Â Â          â”œâ”€â”€ contoroller
    â”‚Â Â          â”œâ”€â”€ domain
    â”‚Â Â          â”œâ”€â”€ infrastructure
    â”‚Â Â          â”œâ”€â”€ plugins
    â”‚Â Â          â””â”€â”€ usecase
    â””â”€â”€ resources
</code></pre><p><code>controller</code>ã‚’<code>ui</code>ã€<code>usecase</code>ã‚’<code>application</code>ãªã©ã¨ã—ã¦ã„ã‚‹ã¨ã“ã‚ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€
æ¯”è¼ƒçš„ã‚ˆãè¦‹ã‹ã‘ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†ã‘ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p><p>ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ†ã‘ã‚‹æ§‹æˆï¼ˆãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã‚‚ã‚ã‚Šã¾ã™ãŒã€
ä»Šå›ã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹ã“ã¨ã§ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åˆ†é›¢ã—ã¦ã„ã¾ã™ã€‚</p><p>ä¸‹è¨˜ã®è¨˜äº‹ã¯ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæœ¬é¡Œã§ã¯ãªã„ã®ã§ã™ãŒã€
ãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã®æ‰‹é †ã‚„è¦ç‚¹ãªã©ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§ãŠã™ã™ã‚ã§ã™ã€‚<br><a href=https://zenn.dev/loglass/articles/6c449ab8a750f2#%E3%83%9E%E3%83%AB%E3%83%81%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E5%8C%96 target=_blank rel="noopener noreferrer">ã€ãªã‚“ã¨ãªãä½¿ã‚ãªã„Gradleï½œãƒãƒ«ãƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã€</a><br>ï¼ˆä»Šå¹´ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¨˜äº‹ã¨ã„ã†ã“ã¨ã‚‚ã‚ã£ã¦å‚ç…§ï¼‰</p><h2 id=controllerå±¤ã‚’è¿½åŠ >Controllerå±¤ã‚’è¿½åŠ </h2><p>ã€å®Ÿè£…ç‰©ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰ã€ã®ç« ã§ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã§å…¨ã¦ã®å‡¦ç†ã‚’å®Œçµã•ã›ã¦ã„ã¾ã—ãŸã€‚<br>ã“ã®ã¾ã¾ã§ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ãŒã™ã”ãè¦‹ã¥ã‚‰ããªã£ã¦ã—ã¾ã†ã®ã§ã€ã¾ãšã¯ãã“ã‚’ç›´ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/91aefa329186651c9cd3802cce0a05da285b066e target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {
    routing {
        get(&quot;/&quot;) {
            val contentController = ContentController()
            val contents: List&lt;Content&gt; = contentController.list()
            call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents)))
        }
    }
}
</code></pre><p>å‡¦ç†ã®ä¸€éƒ¨ã‚’Controllerå±¤ã«ç§»å‹•ã—ã¾ã—ãŸã€‚<br></p><p>ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‡¦ç†ã¯ä»Šã¯ã¾ã è¡Œæ•°ãŒå°‘ãªã„ã®ã§è¦‹ãŸç›®ã®å¤‰åŒ–ãŒå°‘ãªã„ã§ã™ãŒã€
å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã£ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æ¸¡ã™ã ã‘ã«ãªã‚Šã€è‹¥å¹²å‡¦ç†ãŒè¦‹ã‚„ã™ããªã‚Šã¾ã—ãŸã€‚</p><p>Controllerå±¤ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/contoroller/contents/ContentController.kt

data class Content(val id: Int, val name: String, val price: Int)

class ContentController() {
    fun list(): List&lt;Content&gt; {
        return listOf(
            Content(1, &quot;èµ¤ãƒšãƒ³&quot;, 100),
            Content(2, &quot;é’ãƒšãƒ³&quot;, 200),
            Content(3, &quot;é»„ãƒšãƒ³&quot;, 300),
        )
    }
}
</code></pre><p>Controllerã¯ç”»é¢è¡¨ç¤ºã«å¿…è¦ãªæƒ…å ±ã‚’é©åˆ‡ãªå½¢å¼ã§è¿”ã—ã¾ã™ã€‚</p><p>ã“ã“ã§ã‚‚å•†å“æƒ…å ±ã¯ä¸€æ—¦ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ã™ã€‚</p><p>ã§ã¯ã€ç”»é¢ã‚’è¦‹ã¦ã¿ã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_controller.webp width=600><p>é»„ãƒšãƒ³ãŒå¢—ãˆã¦ãŠã‚Šã€Controllerã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã›ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚</p><h2 id=usecaseå±¤ãŠã‚ˆã³domainå±¤ã‚’è¿½åŠ >UseCaseå±¤ãŠã‚ˆã³Domainå±¤ã‚’è¿½åŠ </h2><p>æ¬¡ã«ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚’åˆ†é›¢ã—ãŸä¸Šã§ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å˜ä½ã§å‡¦ç†ã‚’åˆ†é›¢ã—ã¦ã„ãã¾ã™ã€‚<br>ãªãŠã€ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã¨ã„ãˆã‚‹ã€Œãªã«ã‹ã€ã‚’è¦‹ã„ã ã›ã¾ã›ã‚“ã§ã—ãŸã€‚<br>ã‚ˆã£ã¦ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ãŸã ã®ãƒ‡ãƒ¼ã‚¿ã®è©°ã‚ç‰©ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/a047294f1911fa45f11f481b8a835ceb62a80032 target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/contoroller/contents/ContentController.kt

data class ContentView(
    val id: Int,
    val name: String,
    val price: Int
) {
    companion object {
        fun of(content: Content): ContentView {
            return ContentView(
                id = content.id,
                name = content.name,
                price = content.price,
            )
        }
    }
}

data class ContentsView(
    val values: List&lt;ContentView&gt;,
) {
    companion object {
        fun of(contents: List&lt;Content&gt;): ContentsView {
            return ContentsView(
                values = contents.map { ContentView.of(it) }
            )
        }
    }
}

class ContentController(
    private val listContentUseCase: ListContentUseCase
) {
    fun list(): ContentsView {
        return ContentsView.of(listContentUseCase.execute())
    }
}
</code></pre><p>Controllerã‚’å¤‰æ›´ã—ã¦ã¿ã¾ã—ãŸã€‚<br>ä»¥ä¸‹ã®é€šã‚ŠUseCaseçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>fun list(): ContentsView {
    return ContentsView.of(listContentUseCase.execute())
}
</code></pre><p>æˆ»ã‚Šå€¤ã¯Viewã®ãŸã‚ã«ç”¨æ„ã—ãŸdata classã«ç½®ãæ›ãˆã¦ã„ã¾ã™ã€‚<br></p><p>ã“ã†ã™ã‚‹ã“ã¨ã§è¡¨ç¤ºã®ãŸã‚ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒUseCaseä»¥é™ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ï¼ˆã‚„å‡¦ç†ï¼‰ã«ä¸å¿…è¦ã«ä¾å­˜ã™ã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚<br>ï¼ˆé€†ã‚‚ã—ã‹ã‚Šï¼‰</p><p>UseCaseã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/usecase/ListContentUseCase.kt

class ListContentUseCase {
    fun execute(): List&lt;Content&gt; {
        return listOf(
            Content(1, &quot;èµ¤ãƒšãƒ³&quot;, 100),
            Content(2, &quot;é’ãƒšãƒ³&quot;, 200),
            Content(3, &quot;é»„ãƒšãƒ³&quot;, 300),
        )
    }
}
</code></pre><p>ä»Šå›UseCaseã®æˆ»ã‚Šå€¤ã«ã¯å¾Œã»ã©ç¤ºã™<code>Content</code>ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚<br>UseCaseå±¤ã®æˆ»ã‚Šå€¤ç”¨ã«data classã‚’ç”¨æ„ã™ã‚‹ã‚„ã‚Šæ–¹ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€
ä»Šå›ã¯è©°ã‚æ›¿ãˆã®ã‚³ãƒ¼ãƒ‰ã‚’çœç•¥ã™ã‚‹ãŸã‚ã«ã“ã†ã—ã¾ã—ãŸã€‚</p><p>è©³ç´°ãªå®Ÿè£…ã¯å¾Œã®ç« ã«ä»»ã›ã¾ã™ã€‚</p><p><code>Content</code>ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/domain/entity/Content.kt

class Content (
    val id: Int,
    val name: String,
    val price: Int,
)
</code></pre><p>ãƒ‰ãƒ¡ã‚¤ãƒ³çŸ¥è­˜ã‚’ãªã«ã‚‚è¡¨ç¾ã§ãã¦ã„ãªã„ã®ã§è‰¯ããªã„å®Ÿè£…ã§ã™ãŒã€
å…¨ä½“çš„ãªå®Ÿè£…ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…±æœ‰ã™ã‚‹ã“ã¨ãŒç›®çš„ãªã®ã§ã“ã‚Œã§OKã¨ã—ã¾ã™ã€‚</p><p>æœ€å¾Œã«ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ã¾ã™ã€‚<br>DIã¾ã‚ã‚Šã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä¸€æ—¦ä½¿ç”¨ã›ãšã€æ„šç›´ã«ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã—ã¦ã„ãã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {
    routing {
        get(&quot;/&quot;) {
            val listContentUseCase = ListContentUseCase()
            val contentController = ContentController(
                listContentUseCase = listContentUseCase
            )
            val contents: ContentsView = contentController.list()
            call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents.values)))
        }
    }
}
</code></pre><p>ã“ã“ã¾ã§æ¥ãŸã‚‰ç”»é¢ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_controller.webp width=600><p>å‰å›ç¢ºèªæ™‚ã¨åŒã˜ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚</p><h2 id=infrastructureå±¤ã‚’è¿½åŠ >Infrastructureå±¤ã‚’è¿½åŠ </h2><p>æœ€å¾Œã«Infrastructureå±¤ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚<br>ã¾ãšã¯Stripeã¨ã®é€šä¿¡ã‚’çœã„ã¦ç°¡ç•¥åŒ–ã—ãŸå‡¦ç†ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/f241f9943d2b8540ae94eef86ea36b6aba0ce095 target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><p>UseCaseå±¤ã‚’ä»¥ä¸‹ã®ã¨ãŠã‚Šå¤‰æ›´ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/usecase/ListContentUseCase.kt

class ListContentUseCase(
    private val contentRepository: ContentRepository,
) {
    fun execute(): List&lt;Content&gt; {
        return contentRepository.listAll()
    }
}
</code></pre><p>RepositoryçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚<br>Repositoryã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/domain/repository/ContentRepository.kt

interface ContentRepository {
    fun listAll(): List&lt;Content&gt;
}
</code></pre><p>Domainå±¤ã«ã¯Interfaceã ã‘ç½®ãã€å®Ÿè£…ã¯æ¬¡ã«ç¤ºã™ã¨ãŠã‚ŠInfrastructureå±¤ã«ç½®ãã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/infrastructure/dao/ContentRepositoryImpl.kt

class ContentRepositoryImpl: ContentRepository {
    override fun listAll(): List&lt;Content&gt; {
        return listOf(
            Content(1, &quot;èµ¤ãƒšãƒ³&quot;, 100),
            Content(2, &quot;é’ãƒšãƒ³&quot;, 200),
            Content(3, &quot;é»„ãƒšãƒ³&quot;, 300),
        )
    }
}
</code></pre><p>Interfaceã‚’ã‹ã¾ã—ã¦ã„ã‚‹ã®ã¯ä¾å­˜ã®æ–¹å‘ã‚’é€†è»¢ã•ã›ã‚‹ãŸã‚ã§ã™ã€‚<br>ã“ã®è¾ºã¯ä¸‹è¨˜ã®è¨˜äº‹ã§è©³ç´°ã‚’èª¬æ˜ã—ã¦ã„ã¾ã™ã®ã§ã€èˆˆå‘³ãŒã‚ã‚Œã°ã”å‚ç…§ãã ã•ã„ã€‚<br><a href="https://tech.yyh-gl.dev/blog/go_web_api/#:~:text=%E3%81%93%E3%81%93%E3%81%A7%E3%80%81%E3%83%A6%E3%83%BC%E3%82%B6%E3%81%8B%E3%82%89%20API%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%20%E3%81%8C%E3%81%82%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88%E3%82%92%E8%80%83%E3%81%88%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%99%E3%80%82" target=_blank rel="noopener noreferrer">ã€ã€Go + ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¼ã€‘DDDã‚’æ„è­˜ã—ã¦Web APIã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹ã€</a></p><br><p>æ‰‹æŠœãDIã—ã¦æº–å‚™å®Œäº†ã§ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {
    routing {
        get(&quot;/&quot;) {
            val contentRepository = ContentRepositoryImpl()
            val listContentUseCase = ListContentUseCase(contentRepository)
            val contentController = ContentController(
                listContentUseCase =  listContentUseCase
            )
            val contents: ContentsView = contentController.list()
            call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents.values)))
        }
    }
}
</code></pre><p>ç”»é¢ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/add_controller.webp width=600><p>ã“ã‚Œã¾ã§ã¨åŒæ§˜ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã§ãã¦ã„ã¾ã™ã€‚</p><h2 id=infrastructureå±¤ã‚’æœ¬å®Ÿè£…>Infrastructureå±¤ã‚’æœ¬å®Ÿè£…</h2><p>ãŠå¾…ãŸã›ã—ã¾ã—ãŸã€‚<br>Stripeã‹ã‚‰å•†å“æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ãã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/b2b0902583a5f712ca36962a7491422e9f9adb86 target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><p>ã¾ãšã¯Stripe APIã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/infrastructure/api/StripeClient.kt

@Serializable
data class ListProductsResponse(
    val url: String,
    @SerialName(&quot;object&quot;) val obj: String,
    @SerialName(&quot;has_more&quot;) val hasMore: Boolean,
    val data: List&lt;ContentDTO&gt;,
)

@Serializable
data class ContentDTO(
    val id: String,
    @SerialName(&quot;object&quot;) val datumObject: String,
    val name: String,
    val url: String? = null,
    val active: Boolean,
    val attributes: List&lt;String?&gt;,
    @SerialName(&quot;default_price&quot;) val defaultPrice: String,
    val description: String? = null,
    val images: List&lt;String&gt;,
    val livemode: Boolean,
    val metadata: Map&lt;String, String&gt;,
    @SerialName(&quot;package_dimensions&quot;) val packageDimensions: String? = null,
    val shippable: Boolean? = null,
    @SerialName(&quot;statement_descriptor&quot;) val statementDescriptor: String? = null,
    @SerialName(&quot;tax_code&quot;) val taxCode: String? = null,
    val type: String,
    @SerialName(&quot;unit_label&quot;) val unitLabel: String? = null,
    val created: Long,
    val updated: Long,
)

@Serializable
data class ListPricesResponse(
    val url: String,
    @SerialName(&quot;object&quot;) val obj: String,
    @SerialName(&quot;has_more&quot;) val hasMore: Boolean,
    val data: List&lt;PriceDTO&gt;,
)

@Serializable
data class PriceDTO(
    @SerialName(&quot;product&quot;) val productId: String,
    @SerialName(&quot;unit_amount&quot;) val unitAmount: Int,
    val active: Boolean,
)

class StripeClient {
    private val client = OkHttpClient()
    private val baseRequest =
        Request.Builder()
            .addHeader(&quot;Authorization&quot;, &quot;Bearer ${System.getenv(&quot;STRIPE_SECRET_KEY&quot;)}&quot;)
            .addHeader(&quot;ContentType&quot;, &quot;application/x-www-form-urlencoded&quot;)
    private val jsonDecoder = Json { ignoreUnknownKeys = true }

    private fun baseUrl(): HttpUrl.Builder {
        return HttpUrl.Builder().scheme(&quot;https&quot;).host(&quot;api.stripe.com&quot;).addPathSegment(&quot;v1&quot;)
    }

    fun listAllProducts(): List&lt;Content&gt; {
        val listProductsRequest =
            baseRequest.url(baseUrl().addPathSegment(&quot;products&quot;).build()).get().build()
        val listProductsResponseBody = client.newCall(listProductsRequest).execute().body
        val contents =
            jsonDecoder
                .decodeFromString&lt;ListProductsResponse&gt;(listProductsResponseBody!!.string())
                .data

        val productIds = contents.map { it.id }
        val priceMap = listActivePriceMapByProductIDs(productIds)

        return contents.map { Content(id = it.id, name = it.name, price = priceMap[it.id]!!) }
    }

    private fun listActivePriceMapByProductIDs(productIds: List&lt;String&gt;): Map&lt;String, Int&gt; {
        var productQuery = &quot;&quot;
        productIds.forEachIndexed { i, id -&gt;
            productQuery += &quot;product:'${id}'&quot;
            if (i &lt; productIds.size - 1) {
                productQuery += &quot; OR &quot;
            }
        }

        val listPricesRequest =
            baseRequest
                .url(
                    baseUrl()
                        .addPathSegment(&quot;prices&quot;)
                        .addPathSegment(&quot;search&quot;)
                        .addEncodedQueryParameter(&quot;query&quot;, productQuery)
                        .build()
                )
                .get()
                .build()
        val listPricesResponseBody = client.newCall(listPricesRequest).execute().body
        val prices =
            jsonDecoder.decodeFromString&lt;ListPricesResponse&gt;(listPricesResponseBody!!.string()).data

        val priceMap: MutableMap&lt;String, Int&gt; = mutableMapOf()
        prices.forEach { price -&gt;
            if (price.active) {
                priceMap[price.productId] = price.unitAmount
            }
        }
        return priceMap
    }
}
</code></pre><p>å…¨å•†å“æƒ…å ±ã‚’å–å¾—ã™ã‚‹<code>listAllProducts</code>ã¨
æŒ‡å®šå•†å“ã«ç´ã¥ãä¾¡æ ¼æƒ…å ±ã‚’å–å¾—ã™ã‚‹<code>listActivePriceMapByProductIDs</code>ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚<br></p><p>æ³¨æ„ç‚¹ã¨ã—ã¦ã€Stripeã«ãŠã‘ã‚‹å•†å“æƒ…å ±ã¨ä¾¡æ ¼æƒ…å ±ã¯1:Nã®é–¢ä¿‚ã§ã™ã€‚<br>ã—ã‹ã—ã€ä»Šå›ã¯æœ‰åŠ¹ãªä¾¡æ ¼æƒ…å ±ãŒ1ã¤ã—ã‹ãªã„ã¨ã„ã†å‰æã®ã‚‚ã¨ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚</p><br><p>APIãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã¯okhttp3ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚<br>okhttp3ã¯æœ‰åãªHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã®ã§çŸ¥ã£ã¦ã„ã‚‹æ–¹ã‚‚å¤šã„ã§ã—ã‚‡ã†ã€‚</p><p><code>Authorization</code>ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ã¯ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šæ–¹æ³•ã¯å¾Œã»ã©ï¼‰</p><p>Stripeã‹ã‚‰å—ã‘å–ã£ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆJSONï¼‰ã¯
<a href=https://kotlinlang.org/docs/serialization.html#example-json-serialization target=_blank rel="noopener noreferrer">Kotlin Serialization</a>
ã‚’ä½¿ã£ã¦data classã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚</p><p>ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºå¯¾è±¡ã®data classã«ã¯<code>Serializable</code>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ä¸ã—ã¾ã™ã€‚<br>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã¨ã‚­ãƒ¼åãŒä¸€è‡´ã—ãªã„ï¼ˆæ©Ÿæ¢°çš„ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã§ããªã„ï¼‰å ´åˆã¯ã€
<code>SerialName</code>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ãƒãƒƒãƒ”ãƒ³ã‚°æ–¹æ³•ã‚’æŒ‡å®šã—ã¾ã™ã€‚</p><br><p>ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚’ç¶šã‘ã¾ã™ã€‚<br>okhttp3ãŠã‚ˆã³Kotlin Serializationã‚’ä½¿ã†ãŸã‚ã«<code>build.gradle.kts</code>ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/build.gradle.kts

plugins {
  application
  kotlin(&quot;jvm&quot;) version &quot;1.7.21&quot;
  kotlin(&quot;plugin.serialization&quot;) version &quot;1.7.21&quot;
  id(&quot;io.ktor.plugin&quot;) version &quot;2.1.3&quot;
}

&lt;çœç•¥&gt;

dependencies {
  implementation(&quot;io.ktor:ktor-server-core-jvm:$ktor_version&quot;)
  implementation(&quot;io.ktor:ktor-server-freemarker-jvm:$ktor_version&quot;)
  implementation(&quot;io.ktor:ktor-server-netty-jvm:$ktor_version&quot;)
  implementation(&quot;ch.qos.logback:logback-classic:$logback_version&quot;)
  implementation(&quot;com.squareup.okhttp3:okhttp:4.10.0&quot;)
  implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.4.1&quot;)
  testImplementation(&quot;io.ktor:ktor-server-tests-jvm:$ktor_version&quot;)
  testImplementation(&quot;org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version&quot;)
}
</code></pre><p>Infrastructureå±¤ã®å‡¦ç†ã‚‚å¤‰æ›´ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/infrastructure/dao/ContentRepositoryImpl.kt

class ContentRepositoryImpl(
    private val stripeClient: StripeClient,
) : ContentRepository {
    override fun listAll(): List&lt;Content&gt; {

        val contents = stripeClient.listAllProducts()
        return contents.map {
            Content(
                id = it.id,
                name = it.name,
                price = it.price,
            )
        }
    }
}
</code></pre><p>Stripe APIçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚</p><p>DIå‘¨ã‚Šã‚‚å¤‰æ›´ã§ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {
    routing {
        get(&quot;/&quot;) {
            val stripeClient = StripeClient()
            val contentRepository = ContentRepositoryImpl(stripeClient)
            val listContentUseCase = ListContentUseCase(contentRepository)
            val contentController = ContentController(listContentUseCase = listContentUseCase)
            val contents: ContentsView = contentController.list()
            call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents.values)))
        }
    }
}
</code></pre><p><code>Content</code>ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ä¸€éƒ¨å‹å®šç¾©ã‚’é–“é•ã£ã¦ã„ãŸã®ã§ä¿®æ­£ã—ã¾ã™ğŸ™</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/domain/entity/Content.kt

class Content(
    val id: String,
    val name: String,
    val price: Int,
)
</code></pre><p>ä»¥ä¸Šã§ä¿®æ­£ã¯å®Œäº†ã§ã™ã€‚</p><p>å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚<br>å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ãŒå°‘ã—å¤‰ã‚ã‚Šã¾ã™ã€‚</p><p><code>$ STRIPE_SECRET_KEY=xxx ./gradlew run</code><br>ï¼ˆ<code>./gradlew -t build</code>ã¯ãã®ã¾ã¾å®Ÿè¡Œã—ãŸã¾ã¾ï¼‰</p><p>ã•ãã»ã©èª¬æ˜ã‚’å¾Œå›ã—ã«ã—ã¾ã—ãŸãŒã€
Stripe APIã«æ¸¡ã™<code>Authorization</code>ãƒ˜ãƒƒãƒ€ãƒ¼ã®å€¤ï¼ˆ<code>STRIPE_SECRET_KEY</code>ï¼‰ã¯ã“ã“ã§è¨­å®šã—ã¦ã„ã¾ã™ã€‚<br>è¨­å®šã™ã‚‹å€¤ã¯<a href=https://dashboard.stripe.com/test/apikeys target=_blank rel="noopener noreferrer">ã€APIã‚­ãƒ¼ç”»é¢ã€</a>
ã«
è¨˜è¼‰ãŒã‚ã‚‹ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã®å€¤ã§ã™ã€‚</p><p>ã§ã¯ã€ç”»é¢ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/contents_from_stripe.webp width=600><p>è¡¨ç¤ºå†…å®¹ãŒStripeã§ç™»éŒ²ã—ãŸå•†å“æƒ…å ±ã«å¤‰ã‚ã‚Šã¾ã—ãŸã€‚</p><p>ä»¥ä¸Šã§å½“åˆã®ç›®çš„ã§ã‚ã£ãŸ<br>Stripeã‹ã‚‰ã®å•†å“æƒ…å ±å–å¾—â†’è¡¨ç¤ºã¾ã§ã‚’å®Ÿè£…ã§ãã¾ã—ãŸã€‚</p><p><br><br></p><p>ã›ã£ã‹ããªã®ã§DIã‚’ãã¡ã‚“ã¨ã‚„ã£ã¦ãŠãã¾ã™ã€‚</p><h2 id=di>DI</h2><p>ä»Šå›ã¯<a href=https://insert-koin.io/ target=_blank rel="noopener noreferrer">Koin</a>
ã‚’ä½¿ã„ã¾ã™ã€‚</p><p><a href=https://github.com/yyh-gl/ktor-shop/commit/2d382ce90b096e97fd24ccbe23e5bb4b751cc197 target=_blank rel="noopener noreferrer">å‚è€ƒã‚³ãƒŸãƒƒãƒˆ</a></p><br><p><code>dependencies</code>ã«Koinã‚’è¿½åŠ ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/build.gradle.kts

dependencies {
    implementation(&quot;io.ktor:ktor-server-core-jvm:$ktor_version&quot;)
    implementation(&quot;io.ktor:ktor-server-freemarker-jvm:$ktor_version&quot;)
    implementation(&quot;io.ktor:ktor-server-netty-jvm:$ktor_version&quot;)
    implementation(&quot;ch.qos.logback:logback-classic:$logback_version&quot;)
    implementation(&quot;com.squareup.okhttp3:okhttp:4.10.0&quot;)
    implementation(&quot;org.jetbrains.kotlinx:kotlinx-serialization-json:1.4.1&quot;)
    implementation(&quot;io.insert-koin:koin-ktor:3.2.2&quot;)
    implementation(&quot;io.insert-koin:koin-logger-slf4j:3.2.2&quot;)
    testImplementation(&quot;io.ktor:ktor-server-tests-jvm:$ktor_version&quot;)
    testImplementation(&quot;org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version&quot;)
}
</code></pre><p>Koinã«ã‚ˆã‚‹ä¾å­˜è§£æ±ºæ–¹æ³•ã‚’è¨˜è¿°ã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Koin.kt

fun Application.configureKoin() {
    install(Koin) { modules(appModule) }
}

val appModule = module {
    single { StripeClient() }
    single { ContentRepositoryImpl(get()) as ContentRepository }
    single { ListContentUseCase(get()) }
    single { ContentController(get()) }
}
</code></pre><p><code>single { Xxx() }</code>ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ã©ã®ã‚ˆã†ã«ä½œã‚‹ã‹ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚</p><p>ãªãŠ<code>single { ContentRepositoryImpl(get()) as ContentRepository }</code>ã ã‘å°‘ã—è¨˜è¿°ãŒé•ã„ã¾ã™ã€‚<br>ã“ã‚Œã¯<code>ContentRepository</code>ï¼ˆInterfaceï¼‰ã®å®Ÿä½“ã¨ã—ã¦<code>ContentRepositoryImpl</code>ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚</p><br><p>ä½œæˆã—ãŸ<code>Application.configureKoin()</code>ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/Application.kt

fun main(args: Array&lt;String&gt;): Unit = EngineMain.main(args)

fun Application.module() {
  configureKoin()
  configureTemplating()
  configureRouting()
}
</code></pre><p>æ‰‹å‹•ã§DIã—ã¦ã„ãŸç®‡æ‰€ã‚’Koinã‚’ä½¿ã£ãŸDIã«ç½®ãæ›ãˆã¾ã™ã€‚</p><pre class=line-numbers><code class=language-kotlin>// ktor-shop/src/main/kotlin/com/example/plugins/Routing.kt

fun Application.configureRouting() {
    val contentController by inject&lt;ContentController&gt;()

    routing {
        get(&quot;/&quot;) {
            val contents: ContentsView = contentController.list()
            call.respond(FreeMarkerContent(&quot;contents.ftl&quot;, mapOf(&quot;contents&quot; to contents.values)))
        }
    }
}
</code></pre><p><code>val contentController by inject&lt;ContentController>()</code>ã§ä¾å­˜ã‚’æ³¨å…¥ï¼ˆinjectï¼‰ã—ã¦ã„ã¾ã™ã€‚<br>ä»Šå›ã¯<code>ContentController</code>ã‚’ä½¿ãˆã‚Œã°OKãªã®ã§<code>ContentController</code>ã ã‘ã‚’æ³¨å…¥ã—ã¾ã™ã€‚<br></p><p>æ³¨å…¥å¾Œã¯<code>contentController</code>å¤‰æ•°ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€<br>ä¿®æ­£å‰ã¨åŒæ§˜ã«<code>contentController.list()</code>ã¨ã™ã‚Œã°ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</p><br><p>ä»¥ä¸Šã§Koinã®å°å…¥ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>ç”»é¢ã‚’ç¢ºèªã—ã¾ã™ã€‚</p><img src=https://tech.yyh-gl.dev/img/2022/12/kotlin-ktor-stripe-tutorial/contents_from_stripe.webp width=600><p>å¤‰ã‚ã‚‰ãšå‹•ä½œã—ã¾ã™ã­ã€‚</p><h1 id=todo-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°>TODO ã€œã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€œ</h1><p>æœ¬å®Ÿè£…ã§ã¯ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å…¨ãã—ã¦ã„ã¾ã›ã‚“ã€‚<br>å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã—ã£ã‹ã‚Šã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã—ã¦ã‚„ã‚Šã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚<br>ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å‘¨ã‚Šã¯ã¾ãŸåˆ¥ã§è¨˜äº‹ã«ã—ãŸã„ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§å…¬é–‹ã¾ã§ãŠå¾…ã¡ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚<br>ï¼ˆã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ–¹æ³•ãŒå…¨ãç•°ãªã‚‹Goã¨æ¯”è¼ƒã—ãŸè¨˜äº‹ã«ã—ãŸã„ã¨è€ƒãˆã¦ã„ã¾ã™ï¼‰</p><h1 id=ã¾ã¨ã‚>ã¾ã¨ã‚</h1><p>ä»Šå›ã¯Kotlin + Ktorã§ï¼ˆã¨ã¦ã‚‚ç°¡æ˜“çš„ãªï¼‰ECã‚µã‚¤ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚<br>å•†å“æƒ…å ±ã¯Stripeã§ç®¡ç†ã—ã€APIçµŒç”±ã§æƒ…å ±ã‚’å–å¾—ã—è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚<br></p><p>æœ¬è¨˜äº‹ã®å†…å®¹ã‚’ç†è§£ã™ã‚Œã°ã€å¤–éƒ¨APIã‚’ä½¿ç”¨ã—ãŸã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ´ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚</p><p>ç§ãŒKotlinåˆå¿ƒè€…ãªã®ã§ã‚ˆã‚ŠKotlinã‚‰ã—ã„æ›¸ãæ–¹ãŒã§ãã‚‹éƒ¨åˆ†ã‚‚å¤šã€…ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€<br>ã–ã£ãã‚Šã®å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æ´ã‚“ã§ã„ãŸã ã‘ãŸãªã‚‰å¹¸ã„ã§ã™ã€‚</p><br><p>æ˜æ—¥ä»¥é™ã®ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æ¥½ã—ã¿ã«ã—ãªãŒã‚‰ã€ä»Šå›ã¯ã“ã“ã§çµ‚ã‚ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚<br>æœ€å¾Œã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</p></div><footer><div class=stats><ul class=categories><li><a class=article-terms-link href=/categories/kotlin/>Kotlin</a></li><li><a class=article-terms-link href=/categories/ktor/>Ktor</a></li><li><a class=article-terms-link href=/categories/stripe/>Stripe</a></li></ul><div><good-counter rel-permalink=/blog/kotlin-ktor-stripe-tutorial/></good-counter></div></div></footer><div class=fix><a href="https://github.com/yyh-gl/tech-blog/issues/new?template=fix_proposal.md&assignees=yyh-gl&title=ä¿®æ­£ææ¡ˆï¼šã€Ktor%e3%81%a8Stripe%e3%81%a7EC%e3%82%b5%e3%82%a4%e3%83%88%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%a6%e3%81%bf%e3%81%9fã€" target=_blank rel="noopener noreferrer">ä¿®æ­£ææ¡ˆ</a></div></article><div class=pagination><a href=/blog/dmm-to-line/ class="button left"><span>DMM.comã‚’é€€è·ã—ã¾ã—ãŸ</span></a>
<a href=/blog/docker-compose-override/ class="button right"><span>è¤‡æ•°ã®docker-compose.ymlã‚’ä½¿ã£ã¦ã€è¨­å®šã®è¿½åŠ ã‚„ä¸Šæ›¸ãã‚’ã‚„ã£ã¦ã¿ã‚‹</span></a></div></main><section id=site-sidebar><section id=recent-posts><header><h1>æœ€è¿‘ã®æŠ•ç¨¿</h1></header><article class=mini-post><a href=/blog/k8s-setup/ class=image style="--bg-image:url('https://tech.yyh-gl.dev/img/2023/05/k8s-setup/featured.webp')"><img src=https://tech.yyh-gl.dev/img/2023/05/k8s-setup/featured.webp alt=featured></a><header><h2><a href=/blog/k8s-setup/>Indigo VPSä¸Šã«å€‹äººé–‹ç™ºç”¨ã®k8sã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹</a></h2><time class=published datetime="2023-05-04 11:20:17 +0900 +0900">2023-05-04</time></header></article><article class=mini-post><a href=/blog/gomock-generics/ class=image style="--bg-image:url('https://tech.yyh-gl.dev/img/2023/04/gomock-generics/featured.webp')"><img src=https://tech.yyh-gl.dev/img/2023/04/gomock-generics/featured.webp alt=featured></a><header><h2><a href=/blog/gomock-generics/>gomockã®genericså¯¾å¿œçŠ¶æ³</a></h2><time class=published datetime="2023-04-09 00:25:48 +0900 +0900">2023-04-09</time></header></article><article class=mini-post><a href=/blog/dmm-to-line/ class=image style="--bg-image:url('https://tech.yyh-gl.dev/img/2023/01/dmm-to-line/featured.webp')"><img src=https://tech.yyh-gl.dev/img/2023/01/dmm-to-line/featured.webp alt=featured></a><header><h2><a href=/blog/dmm-to-line/>DMM.comã‚’é€€è·ã—ã¾ã—ãŸ</a></h2><time class=published datetime="2023-01-11 00:00:00 +0900 +0900">2023-01-11</time></header></article><footer><a href=/blog/ class=button>ç¶šãã‚’è¦‹ã‚‹</a></footer></section><section id=mini-bio><header><h1>About</h1></header><p>æ±äº¬ã§åƒãã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒãƒ¡ã‚¤ãƒ³ã§ã™ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚„ã‚¤ãƒ³ãƒ•ãƒ©ã‚‚ã•ã‚ã£ã¦ã„ã¾ã™ã€‚</p><footer><a href=/about class=button>ã‚‚ã£ã¨è©³ã—ãçŸ¥ã‚‹</a></footer></section></section><footer id=site-footer><ul class=socnet-icons><li><a href=//github.com/yyh-gl target=_blank rel=noopener title=GitHub class="fa-brands fa-github"></a></li><li><a href=//www.linkedin.com/in/yyh-gl target=_blank rel=noopener title=LinkedIn class="fa-brands fa-linkedin"></a></li><li><a href=//x.com/yyh_gl target=_blank rel=noopener title=Twitter class="fa-brands fa-x-twitter"></a></li><li><a href=//bsky.app/profile/yyh-gl.bsky.social target=_blank title=Bluesky class="fa-solid fa-cloud"></a></li><li><a href=//speakerdeck.com/yyh_gl target=_blank title="Speaker Deck" class="fa-brands fa-speaker-deck"></a></li><li><a href=//crowdin.com/profile/yyh-gl target=_blank title=Crowdin class="fa-solid fa-pen-square"></a></li></ul><p class=copyright>Â© 2023 yyh-gl's Tech Blog<br>Theme: <a href=https://github.com/pacollins/hugo-future-imperfect-slim target=_blank rel=noopener>Hugo Future Imperfect Slim</a><br>A <a href=https://html5up.net/future-imperfect target=_blank rel=noopener>HTML5 UP port</a> | Powered by <a href=https://gohugo.io/ title=0.118.2 target=_blank rel=noopener>Hugo</a></p></footer><a id=back-to-top href=# class="fas fa-arrow-up fa-2x"></a>
<script src=//code.jquery.com/jquery-3.5.1.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.js></script>
<script src=//unpkg.com/lunr/lunr.js></script><script src=/js/bundlecdn.min.9a625977586b3c87851ab16519f6152441caa0cfad47a64dc36241bbf51367ec.js integrity="sha256-mmJZd1hrPIeFGrFlGfYVJEHKoM+tR6ZNw2JBu/UTZ+w="></script>
<script src=/js/add-on.js></script>
<script src=/js/prism.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-140914324-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></div></body></html>